---
title: "Rapport de stage 3A: Machine Learning appliqué à la cybersécurité"
author: "Mathieu Thomassin"
date: "2024-08-31"
description: "Un rapport détaillé sur mon stage de 3e année au SOC, couvrant divers aspects de la cybersécurité et du machine learning."
keywords: ["cybersécurité", "machine learning", "stage", "rapport"]
bibliography: references.bib
---


[Download PDF](index.pdf)

## Table des matières

- [Introduction](#introduction)
- [01 - Découverte et Contexte](#découverte-et-contexte)
- [02 - Recherche et Collecte de Données](#recherche-et-collecte-de-données)
- [03 - Choix des Problèmes et des Outils de Machine Learning](#choix-des-problèmes-et-des-outils-de-machine-learning)
- [04 - Exploration de Modèles et Outils Avancés](#exploration-de-modèles-et-outils-avancés)
- [05 - Anomaly Detection et Modèles de Classification](#anomaly-detection-et-modèles-de-classification)
- [06 - Exploration d'Articles Scientifiques](#exploration-darticles-scientifiques)
- [07 - Modélisation et Évaluation des Modèles](#modélisation-et-évaluation-des-modèles)
- [08 - Travail avec Splunk et Pipelines](#travail-avec-splunk-et-pipelines)
- [09 - Expérimentations et Déploiement](#expérimentations-et-déploiement)
- [10 - Reproductibilité et MLOps](#reproductibilité-et-mlops)
- [Conclusion](#conclusion)
- [Annexe](#annexe)

## Présentation du stagiaire et du maître de stage
- **Stagiaire** : Mathieu THOMASSIN
- **Maître de stage** : Michael ORSUCCI, responsable du *Security Operation Center* de l'Insee
- **Titre du stage** : Machine Learning appliqué à la cybersécurité

## Introduction

L’Insee a renforcé récemment ses capacités opérationnelles en termes de cybersécurité via notamment la création de son SOC (Security Operation Center) en septembre 2023. Devant la quantité de données et leur diversité et face aux évolutions des techniques et tactiques des attaquants, les méthodes de détection de cyberattaques peuvent avoir des limites. L’application d’algorithmes de Machine Learning peut aider les analystes SOC à repérer des attaques. Se déroulant au sein de l’équipe SOC construite depuis peu, le stage va permettre d’appliquer des techniques de Machine Learning et de deep learning sur des jeux de données réelles, afin de participer à la détection d’incidents de sécurité.

### Présentation de l'organisation
L'Insee a renforcé récemment ses capacités opérationnelles en termes de cybersécurité via notamment la création de son SOC (Security Operation Center) en septembre 2023. Cette équipe est répartie entre les sites de la DR de Nantes et la DR de Metz et a pour objectif de renforcer la sécurité du système d'information (SI).

### Contexte général du stage
Devant la quantité de données et leur diversité et face aux évolutions des techniques et tactiques des attaquants, les méthodes de détection de cyberattaques peuvent avoir des limites. L'application d'algorithmes de Machine Learning peut aider les analystes SOC à repérer des attaques. Le stage avait donc pour but de permettre d'appliquer des techniques de Machine Learning et de deep learning sur des jeux de données réelles, afin de participer à la détection d'incidents de sécurité.

### Objectifs du stage
#### Objectifs principaux
Il s'agissait d'appliquer des techniques de détection de requêtes malveillantes arrivant dans le SI de l'Insee. Les requêtes arrivant au sein du SI peuvent être centralisées par un SIEM (Security Information and Event Management).

#### Résultats attendus
- Offrir un service s'ajoutant au SIEM permettant d'identifier des requêtes malveillantes.
- Pouvoir comparer différents meilleurs modèles (au sens d'une recherche dans les hyperparamètres) entre eux.
- Favoriser les bonnes pratiques du MLOps : reproductibilité, contrôle de version, automatisation, surveillance, collaboration.
- Étendre la méthodologie à des jeux de données publics différents.
- Explorer les algorithmes de détection d'anomalie.

### Importance de la mission pour l'Insee
À titre d'exemple, l'Insee détient l'application Elire. Une attaque réussie sur cette application perturberait le bon déroulement de la vie démocratique.
Finaliser la formation d'attaché statisticien en s'appliquant à résoudre un problème concret avant une prise de poste dans un domaine proche.

### Contexte général du stage

<!-- - Pourquoi ce stage est-il pertinent dans votre parcours académique et professionnel ? -->

Ce stage s'inscrit pleinement dans le parcours que j'ai progressivement construit tout au long de ma carrière à l'Insee. Débutant il y a plusieurs années sur un poste de contrôleur-programmeur, j'ai pu apprécier les cours d'informatique et de statistiques pendant mon parcours à l'Ensai. J'y ai suivi les options menant progressivement à se spécialiser jusqu'au master en Informatique et traitement des données.

Au cours de ma préparation et de l'obtention de la qualification d'analyste, ma curiosité pour la sécurité des systèmes d'information s'est particulièrement développée. L'analyse des requêtes au sein d'un réseau soulève de nombreuses questions : volume des données, méthode de traitement statistique avec le machine learning, rapidité et efficacité de ce traitement. C'est un domaine où les techniques de machine learning présentent un intérêt certain.

Les enjeux de la cybersécurité peuvent se révéler particulièrement lourds, comme on peut le découvrir dans les journaux pour de nombreuses organisations. Ce stage au SOC représente une opportunité unique de confronter ces intérêts théoriques à des problématiques concrètes de cybersécurité, renforçant ainsi mes compétences et ma compréhension dans un domaine en pleine expansion.


### Importance de la cybersécurité et du machine learning dans ce domaine

<!-- - Pourquoi la cybersécurité et le machine learning sont-ils cruciaux pour les entreprises aujourd'hui ? -->
La cybersécurité et le machine learning sont cruciaux pour les entreprises aujourd'hui pour plusieurs raisons. D'une part, la cybersécurité est essentielle pour protéger les données sensibles contre les cyberattaques qui sont de plus en plus sophistiquées et fréquentes. Les conséquences d'une faille de sécurité peuvent être dévastatrices pour l'Insee, incluant des pertes de données, des dommages à la réputation et la crédibilité de l'Institut, et des impacts sur les utilisateurs.



D'autre part, le machine learning offre des outils puissants pour détecter et prévenir les menaces en temps réel. Grâce à ses capacités de traitement et d'analyse de vastes quantités de données, le machine learning peut identifier des modèles et des anomalies que les méthodes traditionnelles pourraient manquer. Par exemple, la DSI a déployé sur le poste de chaque agent HarfangLab, un outil de sécurité informatique reposant sur des modèles de machine learning pour détecter la présence de logiciels malveillants, des malware, et permettant d'isoler le poste compromis.

[![HarfangLab, déployé sur le poste de travail](figures/HarfangLab.png "HarfangLab"){width=40%}](https://harfanglab.io/)

Le machine learning permettrait également de réduire le travail des analystes du SOC en classifiant automatiquement les requêtes comme bégnines ou malveillante.


### Objectifs du stage

<!-- - Pourquoi avez-vous défini ces objectifs spécifiques ? -->

En débutant ce stage, j'avais pour but de pouvoir réaliser des objectifs à la fois académiques, en lien avec mes intérêts développés lors de la scolarité, ainsi que des objectifs professionnels, me permettant de m'insérer au mieux dans la structure de l'Insee pour débuter ma carrière d'attaché.


1. **Alignement avec mes objectifs de carrière** : Ce stage présentait une opportunité unique de développer des compétences à la fois en statistique et en informatique. De plus, au lieu de se dérouler dans un service de développement, il a eu lieu dans un service de production, ce qui m'a permis de découvrir une autre perspective de l'informatique par rapport à l'informatique de type "data science" pratiquée à l'Ensai. En renforçant mes compétences en machine learning et en informatique, j'ai donc pu acquérir de l'expérience pour de futurs rôles au sein de l'Insee.

2. **Développement de compétences spécifiques** : Pour réaliser la tâche principale de ce stage, j'avais besoin de maîtriser des techniques de machine learning et de deep learning appliquées à la cybersécurité, ainsi que de les inscrire dans une approche de type DevOps ou MLOps. Il m'a donc fallu utiliser des outils comme Scikit-learn, MLflow, des techniques de deep learning, et utiliser le cluster Kubernetes pour entraîner et déployer un modèle avec une API.

3. **Application pratique des connaissances théoriques** : Si j'ai appris à faire du machine learning à l'école et y ai découvert des notions de DevOps, ce n'est qu'en arrivant en stage que j'ai pu découvrir l'étendue des problèmes pratiques que cela peut poser. Isolés, dans des environnements de travail bien conçus, voire seulement à travers une présentation théorique, les cours m'ont permis d'acquérir des connaissances. Cependant, c'est seulement en travaillant sur des projets réels que j'ai pu répondre de façon pratique en piochant dans la boîte à outils de mes cours.

4. **Contribution à l'organisation d'accueil** : Débutant dans le domaine de la cybersécurité, je n'avais pas pour objectif d'apporter une solution exploitable en production. En revanche, il était essentiel pour moi de démontrer ma capacité future à prendre une position d'ingénieur capable d'envisager un problème nouveau et d'y apporter une solution pratique exploitable par une équipe. La création d'un socle d'entraînement pour un modèle de détection de requêtes malveillantes, destiné à être utilisé par des utilisateurs, sert cet objectif.

5. **Exploration des défis et opportunités** : Face à un nouveau problème pour moi, j'ai voulu prendre le temps d'explorer certaines spécificités liées à la cybersécurité et les pratiques MLOps. J'ai donc recherché, à travers le web, dans des livres et des articles, les méthodes classiques en machine learning pour améliorer la sécurité des systèmes d'information ainsi que les façons possibles de les mettre en œuvre de manière robuste et reproductible.

Ces objectifs m'ont permis de m'assurer que ce stage serait bénéfique pour mon parcours comme pour l'Insee. Cependant, s'ils apparaissent rétrospectivement relativement clairs, ils ont pourtant été construits au fur et à mesure de mon avancée comme nous allons maintenant l'explorer.

## 1. Découverte et Contexte

### Premiers pas dans le stage : Enthousiasme et incertitude

<!-- - Pourquoi avez-vous ressenti ces sentiments au début ? -->
- **Sentiments initiaux** :
Avant de commencer le stage, j'avais pu discuter avec le RSSI (Responsable Sécurité du Système d'Information) et le DSI (Directeur du Système d'Information) de l'Insee au cours d'une formation interne avant l'oral de la qualification d'analyste. J'étais plutôt impressionné par les enjeux, le SI de l'Insee étant régulièrement la cible d'attaques dont j'entendais parler. Cependant, si je savais que je n'étais pas formé comme un "véritable" informaticien [-@noauthor_mi-2020-2_nodate], n'ayant reçu qu'une "sensibilisation à l'informatique de production ou à la sécurité" [-@noauthor_mi-2020-2_nodate-1] p55, j'avais plutôt confiance dans mes récentes capacités à traiter des données et dans mon envie de découvrir le domaine.

- **Raisons de ces sentiments** : Lors de la scolarité, j'avais pris l'habitude d'explorer les rayonnages de la bibliothèque de l'Ensai, et j'y avais repéré un livre [-@chio_machine_nodate] sur le machine learning et la sécurité. Me remémorant ce dont m'avait parlé mon ancien maître de stage sur le plan de reprise d'activité de l'application critique Elire, et en sachant qu'un système informatique génère une quantité de données sur lesquelles il est possible de travailler pour mieux en comprendre les rouages, la perspective de travailler sur la sécurité du SI de l'Insee m'intéressait beaucoup. Cependant, je n'avais pas encore d'idée sur l'application concrète d'un tel projet, ce qui me plongeait dans une certaine incertitude.

- **Objectifs personnels initiaux** : C'est pourquoi, j'avais tout d'abord comme objectif de mieux comprendre ce qu'il était possible de faire en sécurité informatique au sein de l'Insee. N'y avait-il pas déjà des outils externes très performants ? Qu'était-il possible d'apporter en tant qu'attaché statisticien débutant ?

### Introduction à la cybersécurité : Définition et importance

<!-- - Pourquoi est-il important de comprendre les bases de la cybersécurité dès le début ? -->
- **Définition de la cybersécurité** : La cybersécurité consiste à protéger les systèmes, les réseaux et les programmes contre les attaques numériques. [-@noauthor_quest-ce_nodate] Elle vise à garantir la confidentialité, l'intégrité et la disponibilité des informations. Assurer la sécurité du système d'information (SSI) consiste à gérer les risques de sécurité selon une démarche en trois étapes: lister, évaluer et traiter les risques. [-@noauthor_dechiffrer_nodate] La notion de SOC, *Security Operation Center*, devient alors essentiel pour mettre en oeuvre une politique de cybersécurité. UN SOC, doit "monitorer l'ensemble des composants d'un système d'information et être capable de détecter et de sélectionner parmi des milliards d'octets des éléments caractéritiques d'une cyberattaque" [-@noauthor_cybersecurite_2024].
- **Importance de la cybersécurité** : Une attaque informatique a aujourd'hui d'autant plus de valeur que l'activité des organisations est pratiquement toujours menée à l'aide d'outils informatiques. Sans défendre correctement cet outil, la continuité de l'activité est menacée d'interruption plus ou moins forte. La cybersécurité cherche également à protéger les données sensibles et personnelles, notamment au travers de l'obligation légale issue du Règlement Général sur la Protection des Données (RGPD). La confiance que le grand public accorde à l'Insee serait amoindrie en cas d'attaque réussie. C'est pourquoi la cybersécurité doit faire l'objet d'un soin permanent par l'Insee.

- **Liens avec le machine learning** : La cybersécurité est très naturellement un domaine d'application du machine learning. En effet, on peut y obtenir des jeux de données robustes qui permettront "d'annuler certains des progrès les plus complexes dans la compétence des attaquants". Le machine learning peut ainsi améliorer ou remplacer les "solutions basées sur des règles dans des problèmes comme la détection d'intrusion, la classification des logiciels malveillants ou l'analyse réseau" ([-@chio_machine_nodate p.5-6] ).

### Présentation de l'équipe SOC et du système d'information (SI)

<!-- - Pourquoi la compréhension de l'équipe et du SI est-elle cruciale pour votre stage ? -->
#### Structure de l'équipe SOC

L'équipe SOC de l'Insee a été créée en 2023 et est constituée de 6 membres répartis sur deux sites : Nantes et Metz. Son objectif principal est d'établir et de mettre en œuvre la politique de sécurité du système d'information (SI) de l'Insee. L'équipe est dirigée par un responsable unique qui pilote les travaux de manière transversale entre les deux sites. Les membres de l'équipe incluent des analystes de sécurité, des ingénieurs en cybersécurité, et des experts en gestion des incidents.

#### Fonctionnement du SOC

L'équipe SOC a pour mission de surveiller en permanence le SI de l'Insee afin de détecter, qualifier et remédier aux incidents de sécurité. Les principales activités du SOC incluent [-@noauthor_57snssi03020ac_nodate]:

- **Veille et qualification des vulnérabilités** : Identifier quotidiennement les vulnérabilités affectant le SI de l'Insee et évaluer leur impact potentiel.

- **Conception de solutions de sécurité** : Développer et mettre en place des solutions technologiques pour renforcer la sécurité du SI, notamment par la mise en place de solutions techniques innovantes pour garantir la sécurité du SI.

- **Détection et gestion des incidents** : Utiliser des outils avancés comme le SIEM (Security Information and Event Management) ou des EDR (Endpoint Detection and Response) pour détecter les activités suspectes et les incidents de sécurité, puis élaborer et mettre en œuvre des plans de remédiation en collaboration avec les équipes concernées.

- **Maintien en condition de sécurité** : Assurer la sécurité continue des différents systèmes d'information en surveillant les infrastructures et en veillant à l'application des correctifs nécessaires.

- **Support et expertise** : Apporter une expertise en sécurité aux différentes unités de l'Insee, conseiller sur les meilleures pratiques et aider à la décision en matière de sécurité informatique.


L'équipe SOC joue un rôle crucial dans la préservation de l'intégrité, de la confidentialité et de la disponibilité des données et des systèmes de l'Insee. Leur travail permet de protéger les actifs numériques de l'organisation contre une variété de menaces cybernétiques.

- **Présentation du SI** : Le système d'information de l'Insee est documenté sur un wiki interne [-@noauthor_reseau_2024]. On peut notamment y trouver des schémas sur l'architecture du SI de production, mais pas sur celle du SI d'administration. L'architecture du SIA est très fortement guidée par les recommandations de l'anssi. [-@noauthor_recommandations_nodate] Pour l'essentiel, on peut retenir une organisation en 3 couches.

![Schéma simplifié du Système d'Information de l'Insee](figures/schema_SI_simplifie.png "SI de l'Insee")

Le plus important pour le stage étant que le SI a un unique point d'entrée/sortie en zone 0: un firewall F5 qui permet de sécuriser et gérer le trafic réseau. C'est une solution sophistiquée (prix de vente global supérieur à 60 000 €) qui va protéger les applications et le réseau contre un large éventail de menaces tout en optimisant les performances et la disponibilité des services.

### Compréhension du SIEM et des logs

<!-- - Pourquoi le SIEM et les logs sont-ils essentiels dans le contexte de la cybersécurité ? -->
- **Rôle du SIEM** : Un SIEM (Security Information and Event Management) est essentiel dans la conduite d'une politique de sécurité informatique. C'est un outil qui rassemble des données provenant de différentes machines du système d'information, les centralise et effectue des analyses sur elles. Chaque appareil du réseau génère des logs que l'on peut regrouper en deux types :

- **Logs centrés sur l'hôte** : Capturent les événements survenus à l'intérieur de la machine hôte, tels qu'un utilisateur accédant à un fichier ou l'exécution d'un processus.

- **Logs centrés sur le réseau** : Génèrent des logs lorsque les machines communiquent entre elles ou avec l'extérieur, comme le trafic web sur le site www.insee.fr, un fichier récupéré via le protocole FTP, ou encore un utilisateur se connectant au moyen d'un VPN.

L'importance du SIEM provient du fait que le flux des logs est très important, de l'ordre de plusieurs dizaines de Go par jour pour le SI de l'Insee. En cas d'incident, examiner les logs machine par machine est une tâche pratiquement impossible sans SIEM. Il est possible de paramétrer certaines règles qui vont permettre de créer des alarmes. Un SIEM permet de faire des recherches dans les logs, de corréler les événements et de répondre rapidement aux incidents grâce à un système de détection et d'alerte en temps réel.


- **Utilisation des logs** : Tous les appareils du SI génèrent des logs comme on l'a vu. Par exemple Windows enregistre tous les événements, visibles sur l'Event Viewer. Chaque type de log reçoit un ID ce qui permet une analyse plus facile. Ces logs peuvent être envoyées ("forwardées") au SIEM. On peut aussi récupérer des logs sur une machine Linux (ce qui concerne notamment les serveurs dans le SI de l'Insee). De même, il est très important de surveiller les requêtes et les réponses sur les serveurs webs afin de détecter des attaques webs. C'est un point central dans ce stage. Voici un exemple de ce dernier type de log

 **Exemple de log issue d'une requête web :**
```default
127.0.0.1 - - [21/March/2022:10:22:04 -0300] "GET / HTTP/1.0" 200 2216
```
- **Client IP** : 127.0.0.1 (localhost)
- **Identd** : - (non utilisé)
- **Utilisateur Authentifié** : - (non utilisé)
- **Date et Heure** : 21 mars 2022, 10:22:04 (UTC-3)
- **Demande HTTP** : GET / (utilisant HTTP/1.0)
- **Code de Statut** : 200 (OK)
- **Taille de la Réponse** : 2216 octets

Lorsqu'une menace atteignant le SI est détectée par le SIEM, une alerte est lancée. Cette dernière permet aux analystes du SOC de la traiter. Un SIEM permet donc d'obtenir une visibilité sur l'ensemble des points du SI qui y auront été connectés. Dans le cadre du stage, j'ai pu accéder à un test de Splunk sur la partie du SI en zone sécurisée. Ainsi, j'ai été capable de récupérer les logs provenant du F5 positionné à l'entrée de cette zone 50.

<!-- - **Intégration des logs dans le SIEM** : Mentionnez comment les logs sont intégrés et utilisés par le SIEM pour la surveillance et la détection des menaces. -->

## 2. Recherche et Collecte de Données

### Attente de Splunk et recherche de datasets pertinents

<!-- - Pourquoi avez-vous choisi d'utiliser Splunk et quels critères ont guidé la recherche des datasets ? -->
Au début du stage, le SIEM Splunk n'était pas encore prêt. Je ne connaissais pas encore les données possibles. J'ai donc cherché des exemples de machine learning dans le domaine de la cybersécurité.
  - Types de données : Réseau, logs, HTTP
    <!-- - Pourquoi ces types de données spécifiques sont-ils importants ? -->
il a fallu comprendre le type de données sur lesquelles travailler. De nombreuses travaux sont disponibles en cybersécurité. Il existe également un certain nombre de datasets disponibles. Par exemple, on peut trouver des données sur des paquets de type "PCAP", des jeux de données avec des tentatives d'intrusion, des malwares ou bien des urls de sites webs malicieux. Sans problème à résoudre bien identifié, il est compliqué de s'orienter dedans.
Voici quelques exemples de jeux de données disponibles:
<!-- #TODO : mettre des exemples -->
1. Frameworks and Models
2. Encrypted Traffic Analysis
3. Intrusion Detection
4. Botnet and Ransomware
5. URL-based Threats
6. Cloud Infrastructure Security
7. Malware Analysis
8. Network and Host Events
9. Miscellaneous Datasets

Un type de données





### Présentation des premières données sélectionnées
<!-- - Pourquoi ces données sont-elles pertinentes pour votre projet ? -->

Le jeu de données "good_bad_queries" disponible ICI <!-- #TODO mettre le lien vers le repo github --> a constitué une étape importante. En effet, ce jeu de données est très simple. Il est constitué de deux fichiers. L'un "good_queries.txt" contient des url de requêtes http non malicieuses, et l'autre "bad_queries.txt" contient des requêtes malicieuses. Ce sont des fichiers de texte, sur une seule colonne. Voici un exemple:
<!-- #TODO mettre des lignes de chaque fichier -->

La simplicité de ce jeu de données est à relativiser. Dans le cadre du stage, il est intéressant d'apprendre à le connaître par une première analyse descriptive. En effet, dans les données issues du firewall f5, auxquelles j'ai eu accès plus tard, on s'aperçoit vite qu'une attaque est avant tout portée par le contenu de ce champ. D'autres champs d'une requête peuvent aider à déterminer s'il s'agit d'une attaque ou non, mais sans l'url, il est pratiquement imposssible de conclure.
Voici une petite analyse descriptive de ce jeu de données:
<!-- #TODO faire l'analyse descriptive depuis le notebook -->

## 3. Choix des Problèmes et des Outils de Machine Learning

recherche de sites, un bien: https://github.com/jivoi/awesome-ml-for-cybersecurity

### Définition des problèmes de machine learning en cybersécurité

<!-- - Pourquoi est-il crucial de bien définir les problèmes avant de choisir les outils ? -->
faut-il faire de la détection d'anomalie (non supervisé) ou bien de la classification (supervisée)

### Introduction à Scikit-learn et choix des modèles

<!-- - Pourquoi avez-vous choisi Scikit-learn et ces modèles spécifiques ? -->
road map de scikit learn: https://scikit-learn.org/1.3/tutorial/machine_learning_map/index.html

### Formation à l'interprétabilité des modèles
shap: https://train.learn.datascientest.com/notebooks/137/447
<!-- - Pourquoi l'interprétabilité est-elle importante dans le contexte de la cybersécurité ? -->

## 4. Exploration de Modèles et Outils Avancés

### Essais avec XGBoost pour la classification des malwares

<!-- - Pourquoi avez-vous choisi XGBoost pour ce problème ? -->
essai simple et rapide, mais hors sujet. Retour sur good bad queries

### Découverte de MLflow et utilisation de l'API
Comment gérer tous ces notebook ? cf. cours de Lino
<!-- - Pourquoi MLflow est-il utile pour votre projet ? -->

### Introduction au deep learning avec le livre "Deep Learning from Scratch" (DLFS)
Bon, il va falloir faire du deep learning, mais comment s'y prendre vraiment ? Est-ce uqe j'ai bien compris en cours ? Voyons voir. Ah oui, on peut battre une régression linéaire avec du deep learning fait soi même. Voir le livre.
<!-- - Pourquoi ce livre et le deep learning sont-ils pertinents pour vos objectifs ? -->

### Exploration des design patterns en deep learning
<!-- - Pourquoi est-il important de comprendre ces design patterns ? -->
Aller voir les différences possibles dans les modèles pour implémenter ensuite.


## 5. Anomaly Detection et Modèles de Classification

### Détour par la détection d'anomalies : Difficultés et recentrage
<!-- - Pourquoi avez-vous rencontré ces difficultés et comment avez-vous réajusté votre approche ? -->
on peut facilement faire de la détection d'anomalie avec des algo, l'article fondateur est disponible. Mais le sujet apparaît encore trop difficile. Je n'ai pas encore les données, mais je peux accéder à des dataset de requête http labellisé. Donc on va se recentrer dessus.


### Analyses simples avec KNN et clustering
<!-- - Pourquoi avez-vous choisi ces méthodes pour l'analyse initiale ? -->
très difficile de faire ce genre de chose, car la tokenization implique de passer en grande (grande...) dimension. Curse of dimensionality.
Le clustering ne nous intéresse pas pour répondre à un problème d'analyste SOC. Je veux pouvoir analyser une requête, pas connaître des clusters.

### Analyse des données HTTP et détection des attaques (ex. DDOS)
<!-- - Pourquoi ces types d'attaques sont-ils une priorité dans votre analyse ? -->
On ne peut pas détecter du DDOS, et ce n'est pas l'objet. Il sera trop tard. Donc on va encore limiter à des requêtes pour d'autres attaques.

### Focalisation sur l'analyse des URL et compréhension des attaques
<!-- - Pourquoi l'analyse des URL est-elle cruciale dans la détection des attaques ? -->
quelques documents disponibles, les champs (description dans un des articles)
COmment tokenizer la données ?


## 6. Exploration d'Articles Scientifiques

### Lecture et analyse de l'article "Machine Learning for Cybersecurity Applications" de la West Virginia University (WVU)

<!-- - Pourquoi cet article est-il pertinent pour votre travail ? -->

### Étude de "A Comprehensive Review of Anomaly Detection in Web Logs" du Hasso Plattner Institute (HPI)
<!-- - Pourquoi cet article est-il pertinent pour votre travail ? -->
Beaucoup de choses peuvent être faite dans la détection, mais finalement pas tant de problèmes similaires au mien.


### Exploration de "Conf_SIN2022__SWAF" pour le développement d'un pare-feu applicatif basé sur du machine learning
<!-- - Pourquoi cet article est-il pertinent pour votre travail ? -->
VOILà! ils utilisent un dataset que j'ai, avec une technique que je comprends.
On peut reproduire le réseau de neurones. Mais pas les résultats. Cependant, leur technique de (non) tokenization est simple et apporte un excellent résultat sur le dataset good/bad queries.


## 7. Modélisation et Évaluation des Modèles

### Modélisation des URL : KNN, SVM, regression logistique, CNN
<!-- - Pourquoi avez-vous choisi ces modèles spécifiques pour la modélisation des URL ? -->
Certains choix s'imposent par leur simplicité ou leur rapidité. Cependant, il faut rapidement se rendre compte que les scores f1 sont mauvais et qu'une autre solution peut être tentée.


### Utilisation de ChatGPT et des GPU pour accélérer le développement
<!-- - Pourquoi ces outils ont-ils été utilisés pour accélérer le développement ? -->
Clairement, accéder à un GPU est crucial pour l'entraînement des réseaux de neurones. On passe parfois de 2h à 20 minutes.
De son côté, CHatgpt 4o permet, par itération, de debugguer rapidement, de documenter à grande vitesse et surtout de coder des éléments selon des spécifications qui changent rapidement.


### Organisation des priorités et gestion des expérimentations
<!-- - Pourquoi cette organisation est-elle importante pour la réussite de votre projet ? -->
Il a fallu commencer à développer un pipeline permettant d'utiliser MLflow, puis de requêter le modèle taggué comme "en production" dans MLflow. Cela constituait une application "minimum".


## 8. Travail avec Splunk et Pipelines

### Traitement des données Splunk en préproduction

<!-- - Pourquoi le traitement des données en préproduction est-il nécessaire ? -->
Splunk étant mis en test, j'ai pu manipuler le siem et me rendre compte des données que je récupérais.


### Tokenization des URL et limitations

<!-- - Pourquoi avez-vous utilisé cette méthode de tokenization et quelles en sont les limites ? -->
Une tokenization classique: sujette à l'imagination et source de versions infinies. Mais dont les limites surviennent lors de la conception du modèle. donner exemple de codes
Jusqu'à l'idée de l'article: pas de tokenization mais un passage par le code Ascii. donner la fonction.

### Développement de pipelines et utilisation de GridsearchCV
<!-- - Pourquoi ces techniques sont-elles cruciales pour optimiser les modèles ? -->
Pour pouvoir calibrer le modèle, il faut pouvoir jouer sur les hyper paramètres. Il a donc fallu trouver comment utiliser GridsearchCV => consommateur de temps.


### Évaluation des performances des modèles
<!-- - Pourquoi une évaluation rigoureuse des performances est-elle essentielle ? -->
On peut avoir un score accuracy très élevé, mais un f1 très bas car les classes sont déséquilibrées.
pas de problème de datadrift, car pas encore de données. Les datasets sont fixes. Mais c'est un problème.


## 9. Expérimentations et Déploiement

### Utilisation de MLFlow pour la gestion des expérimentations
<!-- - Pourquoi MLFlow est-il un choix stratégique pour gérer les expérimentations ? -->
MLflow vs. Metaflow.


### Apprentissage à requêter et déployer un modèle via une API
<!-- - Pourquoi cette compétence est-elle importante dans le cadre de votre stage ? -->
utilisation de FastAPI


### Déploiement sur un cluster Kubernetes et gestion du preprocessing
<!-- - Pourquoi Kubernetes et le preprocessing sont-ils importants pour le déploiement ? -->
Assure une stabilité du site.
Il faut reproduire le preprocessing utilisé dans la construction du modèle pour pouvoir utiliser l'API.
construction du modèle => stockage du modèle dans MLFlow + stockage du preprocessor dans Minio
Utilisation de l'API => download le preprocessor (ou réutilise une fonction pour le code ascii (plus simple))
construction de l'image docker (schéma)
utilisation des yaml, des commandes kubernetes


### Introduction à Metaflow (Netflix) et tests préliminaires
<!-- - Pourquoi avez-vous exploré Metaflow et quels avantages cela apporte-t-il ? -->
Metaflow est intéressant car il permet de reprendre une étape du traitement sans avoir à refaire les traitements précédents grâce à un système de "step". TOut est enregistré dans le minio de l'utilisateur (photo).


## 10. Reproductibilité et MLOps

### Importance de la reproductibilité et utilisation des cours de l'ENSAE

<!-- - Pourquoi la reproductibilité est-elle critique dans le domaine du machine learning ? -->

### Réalisation d'un projet MLOps :
<!-- - Pourquoi ces aspects spécifiques du MLOps sont-ils importants ? -->
Continuité entre le développement du modèle mis en production et son utilisation dans une API déployée


### Exploration de Spark pour le calcul et le streaming
<!-- - Pourquoi Spark est-il un outil pertinent pour vos objectifs ? -->
Vu les volumes de données,
pour savoir si il serait possible de brancher directement un modèle de détection sur les url entrantes acceptées par le F5. SInon, il faudrait passer par un cron job et aller download par le bias de l'api splunk.

## Conclusion

### Bilan du stage et accomplissements

<!-- - Pourquoi ces réalisations sont-elles significatives ? -->

### Perspectives futures : Améliorations et extensions possibles

<!-- - Pourquoi ces améliorations sont-elles envisagées ? -->

### Remerciements et réflexions personnelles

<!-- - Pourquoi ces personnes/expériences sont-elles importantes pour vous ? -->

## Annexe

### Ressources supplémentaires : Notebooks, articles, tutoriels, dépôts Github

<!-- - Pourquoi ces ressources sont-elles utiles ? -->

#### Gantt
![Gant](figures/gantt.png)

### Détails techniques des implémentations et configurations

<!-- - Pourquoi ces détails techniques sont-ils importants pour la compréhension de votre travail ? -->

### Bibliographie et références

<!-- - Pourquoi ces références ont-elles été utilisées ? -->

